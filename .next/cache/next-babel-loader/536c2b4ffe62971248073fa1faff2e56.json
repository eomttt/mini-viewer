{"ast":null,"code":"var _jsxFileName = \"/Users/hyuntaeeom/Projects/personal/mini-viewer/pages/index.tsx\";\nvar __jsx = React.createElement;\nimport React from 'react';\nimport { useSelector } from 'react-redux';\nimport Layout from '../components/Layout';\nimport BookList from '../components/books/BookList';\nimport * as booksActions from '../reducers/books';\nimport { getBook, getViewers } from '../lib/util';\n\nconst Home = ({\n  styleLinks\n}) => {\n  const {\n    list\n  } = useSelector(state => state.books);\n  return __jsx(Layout, {\n    styleLinks: styleLinks,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 23\n    },\n    __self: this\n  }, __jsx(BookList, {\n    books: list,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 26\n    },\n    __self: this\n  }));\n}; // eslint-disable-next-line @typescript-eslint/unbound-method\n\n\nHome.getInitialProps = async context => {\n  const {\n    req,\n    store\n  } = context;\n\n  if (req) {\n    const fs = require('fs');\n\n    const {\n      EpubParser\n    } = require('@ridi/epub-parser');\n\n    const booksInfo = [];\n    let styleLinks = [];\n    const files = fs.readdirSync('public/');\n\n    try {\n      // eslint-disable-next-line no-restricted-syntax\n      for (const file of files) {\n        if (file.includes('.epub')) {\n          const publicPath = `epub/${file.split('.epub')[0]}`;\n          const parser = new EpubParser(`public/${file}`);\n          const book = await getBook(parser, {\n            unzipPath: `public/${publicPath}`\n          });\n\n          if (book) {\n            const viewers = await getViewers(parser, {\n              bookSpines: book.spines,\n              publicPath\n            });\n            booksInfo.push({\n              book,\n              viewers,\n              publicPath\n            });\n            styleLinks = styleLinks.concat(book.styles.map(style => `${publicPath}/${style.href}`));\n            console.log(\"AAA\", styleLinks);\n          }\n        }\n      }\n\n      store.dispatch(booksActions.setStyleLinks(styleLinks));\n      store.dispatch(booksActions.setBookList(booksInfo));\n      return {\n        styleLinks\n      };\n    } catch (error) {\n      console.log('Error', error);\n    }\n  }\n\n  return {};\n};\n\nexport default Home;","map":{"version":3,"sources":["/Users/hyuntaeeom/Projects/personal/mini-viewer/pages/index.tsx"],"names":["React","useSelector","Layout","BookList","booksActions","getBook","getViewers","Home","styleLinks","list","state","books","getInitialProps","context","req","store","fs","require","EpubParser","booksInfo","files","readdirSync","file","includes","publicPath","split","parser","book","unzipPath","viewers","bookSpines","spines","push","concat","styles","map","style","href","console","log","dispatch","setStyleLinks","setBookList","error"],"mappings":";;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,WAAT,QAA4B,aAA5B;AAGA,OAAOC,MAAP,MAAmB,sBAAnB;AACA,OAAOC,QAAP,MAAqB,8BAArB;AAEA,OAAO,KAAKC,YAAZ,MAA8B,mBAA9B;AAEA,SAASC,OAAT,EAAkBC,UAAlB,QAAoC,aAApC;;AASA,MAAMC,IAAqB,GAAG,CAAC;AAAEC,EAAAA;AAAF,CAAD,KAAoB;AAChD,QAAM;AAAEC,IAAAA;AAAF,MAAWR,WAAW,CAAES,KAAD,IAAyBA,KAAK,CAACC,KAAhC,CAA5B;AAEA,SACE,MAAC,MAAD;AACE,IAAA,UAAU,EAAEH,UADd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAGE,MAAC,QAAD;AAAU,IAAA,KAAK,EAAEC,IAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAHF,CADF;AAOD,CAVD,C,CAWA;;;AACAF,IAAI,CAACK,eAAL,GAAuB,MAAOC,OAAP,IAAuD;AAC5E,QAAM;AAAEC,IAAAA,GAAF;AAAOC,IAAAA;AAAP,MAAiBF,OAAvB;;AACA,MAAIC,GAAJ,EAAS;AACP,UAAME,EAAE,GAAGC,OAAO,CAAC,IAAD,CAAlB;;AACA,UAAM;AAAEC,MAAAA;AAAF,QAAiBD,OAAO,CAAC,mBAAD,CAA9B;;AACA,UAAME,SAAqB,GAAG,EAA9B;AACA,QAAIX,UAAoB,GAAG,EAA3B;AAEA,UAAMY,KAAK,GAAGJ,EAAE,CAACK,WAAH,CAAe,SAAf,CAAd;;AACA,QAAI;AACF;AACA,WAAK,MAAMC,IAAX,IAAmBF,KAAnB,EAA0B;AACxB,YAAIE,IAAI,CAACC,QAAL,CAAc,OAAd,CAAJ,EAA4B;AAC1B,gBAAMC,UAAU,GAAI,QAAOF,IAAI,CAACG,KAAL,CAAW,OAAX,EAAoB,CAApB,CAAuB,EAAlD;AAEA,gBAAMC,MAAM,GAAG,IAAIR,UAAJ,CAAgB,UAASI,IAAK,EAA9B,CAAf;AACA,gBAAMK,IAAc,GAAG,MAAMtB,OAAO,CAACqB,MAAD,EAAS;AAC3CE,YAAAA,SAAS,EAAG,UAASJ,UAAW;AADW,WAAT,CAApC;;AAIA,cAAIG,IAAJ,EAAU;AACR,kBAAME,OAAO,GAAG,MAAMvB,UAAU,CAACoB,MAAD,EAAS;AACvCI,cAAAA,UAAU,EAAEH,IAAI,CAACI,MADsB;AAEvCP,cAAAA;AAFuC,aAAT,CAAhC;AAIAL,YAAAA,SAAS,CAACa,IAAV,CAAe;AACbL,cAAAA,IADa;AAEbE,cAAAA,OAFa;AAGbL,cAAAA;AAHa,aAAf;AAKAhB,YAAAA,UAAU,GAAGA,UAAU,CAACyB,MAAX,CAAkBN,IAAI,CAACO,MAAL,CAAYC,GAAZ,CAAiBC,KAAD,IAAY,GAAEZ,UAAW,IAAGY,KAAK,CAACC,IAAK,EAAvD,CAAlB,CAAb;AACAC,YAAAA,OAAO,CAACC,GAAR,CAAY,KAAZ,EAAmB/B,UAAnB;AACD;AACF;AACF;;AACDO,MAAAA,KAAK,CAACyB,QAAN,CAAepC,YAAY,CAACqC,aAAb,CAA2BjC,UAA3B,CAAf;AACAO,MAAAA,KAAK,CAACyB,QAAN,CAAepC,YAAY,CAACsC,WAAb,CAAyBvB,SAAzB,CAAf;AAEA,aAAO;AACLX,QAAAA;AADK,OAAP;AAGD,KAhCD,CAgCE,OAAOmC,KAAP,EAAc;AACdL,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBI,KAArB;AACD;AACF;;AACD,SAAO,EAAP;AACD,CA9CD;;AAgDA,eAAepC,IAAf","sourcesContent":["import React from 'react';\nimport { useSelector } from 'react-redux';\nimport { NextPageContext, NextPage } from 'next';\n\nimport Layout from '../components/Layout';\nimport BookList from '../components/books/BookList';\n\nimport * as booksActions from '../reducers/books';\n\nimport { getBook, getViewers } from '../lib/util';\n\nimport { ReducerState } from '../interfaces';\nimport { BookInfo, EpubBook } from '../interfaces/books';\n\ninterface Props {\n  styleLinks: string[];\n}\n\nconst Home: NextPage<Props> = ({ styleLinks }) => {\n  const { list } = useSelector((state: ReducerState) => state.books);\n\n  return (\n    <Layout\n      styleLinks={styleLinks}\n    >\n      <BookList books={list} />\n    </Layout>\n  );\n};\n// eslint-disable-next-line @typescript-eslint/unbound-method\nHome.getInitialProps = async (context: NextPageContext<any>): Promise<any> => {\n  const { req, store } = context;\n  if (req) {\n    const fs = require('fs');\n    const { EpubParser } = require('@ridi/epub-parser');\n    const booksInfo: BookInfo[] = [];\n    let styleLinks: string[] = [];\n\n    const files = fs.readdirSync('public/');\n    try {\n      // eslint-disable-next-line no-restricted-syntax\n      for (const file of files) {\n        if (file.includes('.epub')) {\n          const publicPath = `epub/${file.split('.epub')[0]}`;\n\n          const parser = new EpubParser(`public/${file}`);\n          const book: EpubBook = await getBook(parser, {\n            unzipPath: `public/${publicPath}`,\n          });\n\n          if (book) {\n            const viewers = await getViewers(parser, {\n              bookSpines: book.spines,\n              publicPath,\n            });\n            booksInfo.push({\n              book,\n              viewers,\n              publicPath,\n            });\n            styleLinks = styleLinks.concat(book.styles.map((style) => `${publicPath}/${style.href}`));\n            console.log(\"AAA\", styleLinks);\n          }\n        }\n      }\n      store.dispatch(booksActions.setStyleLinks(styleLinks));\n      store.dispatch(booksActions.setBookList(booksInfo));\n\n      return {\n        styleLinks,\n      };\n    } catch (error) {\n      console.log('Error', error);\n    }\n  }\n  return {};\n};\n\nexport default Home;\n"]},"metadata":{},"sourceType":"module"}