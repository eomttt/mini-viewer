{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport axios from 'axios';\nexport var getBook = function getBook(parser, _ref) {\n  var unzipPath, book;\n  return _regeneratorRuntime.async(function getBook$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          unzipPath = _ref.unzipPath;\n          _context.prev = 1;\n          _context.next = 4;\n          return _regeneratorRuntime.awrap(parser.parse({\n            validatePackage: true,\n            parseStyle: false,\n            unzipPath: unzipPath\n          }));\n\n        case 4:\n          book = _context.sent;\n          return _context.abrupt(\"return\", book);\n\n        case 8:\n          _context.prev = 8;\n          _context.t0 = _context[\"catch\"](1);\n          console.log('Get book error', _context.t0);\n\n        case 11:\n          return _context.abrupt(\"return\", null);\n\n        case 12:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, [[1, 8]], Promise);\n};\nexport var getViewers = function getViewers(parser, _ref2) {\n  var bookSpines, publicPath, viewers;\n  return _regeneratorRuntime.async(function getViewers$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          bookSpines = _ref2.bookSpines, publicPath = _ref2.publicPath;\n          _context2.prev = 1;\n          _context2.next = 4;\n          return _regeneratorRuntime.awrap(parser.readItems(bookSpines, {\n            force: true,\n            extractBody: true,\n            serializedAnchor: true,\n            ignoreScript: true,\n            basePath: publicPath\n          }));\n\n        case 4:\n          viewers = _context2.sent;\n          return _context2.abrupt(\"return\", viewers);\n\n        case 8:\n          _context2.prev = 8;\n          _context2.t0 = _context2[\"catch\"](1);\n          console.log('Get viewers error', _context2.t0);\n\n        case 11:\n          return _context2.abrupt(\"return\", []);\n\n        case 12:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, null, null, [[1, 8]], Promise);\n};\nexport var getBookInfo = function getBookInfo(EpubParser, _ref3) {\n  var epubFile, epubPath, parser, book, viewers;\n  return _regeneratorRuntime.async(function getBookInfo$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          epubFile = _ref3.epubFile, epubPath = _ref3.epubPath;\n          parser = new EpubParser(\"public/\".concat(epubFile, \".epub\"));\n          _context3.prev = 2;\n          _context3.next = 5;\n          return _regeneratorRuntime.awrap(getBook(parser, {\n            unzipPath: \"public/\".concat(epubPath)\n          }));\n\n        case 5:\n          book = _context3.sent;\n\n          if (!book) {\n            _context3.next = 11;\n            break;\n          }\n\n          _context3.next = 9;\n          return _regeneratorRuntime.awrap(getViewers(parser, {\n            bookSpines: book.spines,\n            publicPath: epubPath\n          }));\n\n        case 9:\n          viewers = _context3.sent;\n          return _context3.abrupt(\"return\", {\n            book: book,\n            viewers: viewers\n          });\n\n        case 11:\n          _context3.next = 16;\n          break;\n\n        case 13:\n          _context3.prev = 13;\n          _context3.t0 = _context3[\"catch\"](2);\n          console.log('Get book info error', _context3.t0);\n\n        case 16:\n          return _context3.abrupt(\"return\", {\n            book: null,\n            viewers: []\n          });\n\n        case 17:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, null, null, [[2, 13]], Promise);\n};\nexport var isEpubFile = function isEpubFile(fileName) {\n  return fileName.includes('.epub');\n};\nexport var getStyleText = function getStyleText(publicPath, styles) {\n  var res, _iteratorNormalCompletion, _didIteratorError, _iteratorError, _iterator, _step, style, data;\n\n  return _regeneratorRuntime.async(function getStyleText$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          res = []; // eslint-disable-next-line no-restricted-syntax\n\n          _iteratorNormalCompletion = true;\n          _didIteratorError = false;\n          _iteratorError = undefined;\n          _context4.prev = 4;\n          _iterator = styles[Symbol.iterator]();\n\n        case 6:\n          if (_iteratorNormalCompletion = (_step = _iterator.next()).done) {\n            _context4.next = 21;\n            break;\n          }\n\n          style = _step.value;\n          _context4.prev = 8;\n          _context4.next = 11;\n          return _regeneratorRuntime.awrap(axios.get(\"\".concat(publicPath, \"/\").concat(style.href)));\n\n        case 11:\n          data = _context4.sent;\n          res.push(data.data);\n          _context4.next = 18;\n          break;\n\n        case 15:\n          _context4.prev = 15;\n          _context4.t0 = _context4[\"catch\"](8);\n          console.log('Get style text error', _context4.t0);\n\n        case 18:\n          _iteratorNormalCompletion = true;\n          _context4.next = 6;\n          break;\n\n        case 21:\n          _context4.next = 27;\n          break;\n\n        case 23:\n          _context4.prev = 23;\n          _context4.t1 = _context4[\"catch\"](4);\n          _didIteratorError = true;\n          _iteratorError = _context4.t1;\n\n        case 27:\n          _context4.prev = 27;\n          _context4.prev = 28;\n\n          if (!_iteratorNormalCompletion && _iterator[\"return\"] != null) {\n            _iterator[\"return\"]();\n          }\n\n        case 30:\n          _context4.prev = 30;\n\n          if (!_didIteratorError) {\n            _context4.next = 33;\n            break;\n          }\n\n          throw _iteratorError;\n\n        case 33:\n          return _context4.finish(30);\n\n        case 34:\n          return _context4.finish(27);\n\n        case 35:\n          return _context4.abrupt(\"return\", res.join(''));\n\n        case 36:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, null, null, [[4, 23, 27, 35], [8, 15], [28,, 30, 34]], Promise);\n};","map":null,"metadata":{},"sourceType":"module"}