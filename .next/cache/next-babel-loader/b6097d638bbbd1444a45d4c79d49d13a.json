{"ast":null,"code":"var _jsxFileName = \"/Users/hyuntaeeom/Projects/personal/mini-viewer/pages/index.tsx\";\nvar __jsx = React.createElement;\nimport React from 'react';\nimport Layout from '../components/Layout';\nimport BookList from '../components/books/BookList';\n\nconst Home = ({\n  books\n}) => {\n  console.log('AAAA', books);\n  return __jsx(Layout, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 17\n    },\n    __self: this\n  }, __jsx(BookList, {\n    books: books,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 18\n    },\n    __self: this\n  }));\n}; // eslint-disable-next-line @typescript-eslint/unbound-method\n\n\nHome.getInitialProps = async context => {\n  const {\n    req\n  } = context;\n\n  if (req) {\n    const fs = require('fs');\n\n    const {\n      EpubParser\n    } = require('@ridi/epub-parser');\n\n    const books = [];\n    const files = fs.readdirSync('public/');\n\n    try {\n      // eslint-disable-next-line no-restricted-syntax\n      for (const file of files) {\n        if (file.includes('.epub')) {\n          const publicPath = `epub/${file.split('.epub')[0]}`;\n          const parser = new EpubParser(`public/${file}`); // eslint-disable-next-line no-await-in-loop\n\n          const book = await parser.parse({\n            validatePackage: true,\n            parseStyle: false,\n            unzipPath: `public/${publicPath}`\n          }); // eslint-disable-next-line no-await-in-loop\n\n          const viewerSpines = await parser.readItems(book.spines, {\n            force: true,\n            extractBody: true,\n            serializedAnchor: true,\n            ignoreScript: true,\n            basePath: publicPath\n          });\n          books.push({\n            book,\n            publicPath,\n            viewer: viewerSpines\n          });\n        }\n      }\n\n      return {\n        books\n      };\n    } catch (error) {\n      console.log('Error', error);\n    }\n  }\n\n  return {};\n};\n\nexport default Home;","map":{"version":3,"sources":["/Users/hyuntaeeom/Projects/personal/mini-viewer/pages/index.tsx"],"names":["React","Layout","BookList","Home","books","console","log","getInitialProps","context","req","fs","require","EpubParser","files","readdirSync","file","includes","publicPath","split","parser","book","parse","validatePackage","parseStyle","unzipPath","viewerSpines","readItems","spines","force","extractBody","serializedAnchor","ignoreScript","basePath","push","viewer","error"],"mappings":";;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AAGA,OAAOC,MAAP,MAAmB,sBAAnB;AACA,OAAOC,QAAP,MAAqB,8BAArB;;AAQA,MAAMC,IAAqB,GAAG,CAAC;AAAEC,EAAAA;AAAF,CAAD,KAAe;AAC3CC,EAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ,EAAoBF,KAApB;AAEA,SACE,MAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,QAAD;AAAU,IAAA,KAAK,EAAEA,KAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,CADF;AAKD,CARD,C,CASA;;;AACAD,IAAI,CAACI,eAAL,GAAuB,MAAOC,OAAP,IAAuD;AAC5E,QAAM;AAAEC,IAAAA;AAAF,MAAUD,OAAhB;;AACA,MAAIC,GAAJ,EAAS;AACP,UAAMC,EAAE,GAAGC,OAAO,CAAC,IAAD,CAAlB;;AACA,UAAM;AAAEC,MAAAA;AAAF,QAAiBD,OAAO,CAAC,mBAAD,CAA9B;;AACA,UAAMP,KAAiB,GAAG,EAA1B;AAEA,UAAMS,KAAK,GAAGH,EAAE,CAACI,WAAH,CAAe,SAAf,CAAd;;AACA,QAAI;AACF;AACA,WAAK,MAAMC,IAAX,IAAmBF,KAAnB,EAA0B;AACxB,YAAIE,IAAI,CAACC,QAAL,CAAc,OAAd,CAAJ,EAA4B;AAC1B,gBAAMC,UAAU,GAAI,QAAOF,IAAI,CAACG,KAAL,CAAW,OAAX,EAAoB,CAApB,CAAuB,EAAlD;AACA,gBAAMC,MAAM,GAAG,IAAIP,UAAJ,CAAgB,UAASG,IAAK,EAA9B,CAAf,CAF0B,CAG1B;;AACA,gBAAMK,IAAc,GAAG,MAAMD,MAAM,CAACE,KAAP,CAAa;AACxCC,YAAAA,eAAe,EAAE,IADuB;AAExCC,YAAAA,UAAU,EAAE,KAF4B;AAGxCC,YAAAA,SAAS,EAAG,UAASP,UAAW;AAHQ,WAAb,CAA7B,CAJ0B,CAS1B;;AACA,gBAAMQ,YAAY,GAAG,MAAMN,MAAM,CAACO,SAAP,CAAiBN,IAAI,CAACO,MAAtB,EAA8B;AACvDC,YAAAA,KAAK,EAAE,IADgD;AAEvDC,YAAAA,WAAW,EAAE,IAF0C;AAGvDC,YAAAA,gBAAgB,EAAE,IAHqC;AAIvDC,YAAAA,YAAY,EAAE,IAJyC;AAKvDC,YAAAA,QAAQ,EAAEf;AAL6C,WAA9B,CAA3B;AAQAb,UAAAA,KAAK,CAAC6B,IAAN,CAAW;AACTb,YAAAA,IADS;AAETH,YAAAA,UAFS;AAGTiB,YAAAA,MAAM,EAAET;AAHC,WAAX;AAKD;AACF;;AACD,aAAO;AACLrB,QAAAA;AADK,OAAP;AAGD,KA/BD,CA+BE,OAAO+B,KAAP,EAAc;AACd9B,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqB6B,KAArB;AACD;AACF;;AACD,SAAO,EAAP;AACD,CA5CD;;AA8CA,eAAehC,IAAf","sourcesContent":["import React from 'react';\nimport { NextPageContext, NextPage } from 'next';\n\nimport Layout from '../components/Layout';\nimport BookList from '../components/books/BookList';\n\nimport { BookInfo, EpubBook } from '../interfaces/books';\n\ninterface Props {\n  books: BookInfo[];\n}\n\nconst Home: NextPage<Props> = ({ books }) => {\n  console.log('AAAA', books);\n\n  return (\n    <Layout>\n      <BookList books={books} />\n    </Layout>\n  );\n};\n// eslint-disable-next-line @typescript-eslint/unbound-method\nHome.getInitialProps = async (context: NextPageContext<any>): Promise<any> => {\n  const { req } = context;\n  if (req) {\n    const fs = require('fs');\n    const { EpubParser } = require('@ridi/epub-parser');\n    const books: BookInfo[] = [];\n\n    const files = fs.readdirSync('public/');\n    try {\n      // eslint-disable-next-line no-restricted-syntax\n      for (const file of files) {\n        if (file.includes('.epub')) {\n          const publicPath = `epub/${file.split('.epub')[0]}`;\n          const parser = new EpubParser(`public/${file}`);\n          // eslint-disable-next-line no-await-in-loop\n          const book: EpubBook = await parser.parse({\n            validatePackage: true,\n            parseStyle: false,\n            unzipPath: `public/${publicPath}`,\n          });\n          // eslint-disable-next-line no-await-in-loop\n          const viewerSpines = await parser.readItems(book.spines, {\n            force: true,\n            extractBody: true,\n            serializedAnchor: true,\n            ignoreScript: true,\n            basePath: publicPath,\n          });\n\n          books.push({\n            book,\n            publicPath,\n            viewer: viewerSpines,\n          });\n        }\n      }\n      return {\n        books,\n      };\n    } catch (error) {\n      console.log('Error', error);\n    }\n  }\n  return {};\n};\n\nexport default Home;\n"]},"metadata":{},"sourceType":"module"}