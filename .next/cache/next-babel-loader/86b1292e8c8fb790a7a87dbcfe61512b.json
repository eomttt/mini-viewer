{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nvar __jsx = React.createElement;\nimport React, { useEffect } from 'react';\nimport { useSelector } from 'react-redux';\nimport BookList from '../components/books/BookList';\nimport * as booksActions from '../reducers/books';\nimport { getBookInfo, isEpubFile } from '../lib/util';\nimport Layout from '../components/Layout';\n\nvar Home = function Home() {\n  var _useSelector = useSelector(function (state) {\n    return state.books;\n  }),\n      list = _useSelector.list;\n\n  useEffect(function () {\n    if (!list) {\n      window.location.reload();\n    }\n  }, [list]);\n  return __jsx(Layout, null, list && __jsx(BookList, {\n    books: list\n  }));\n}; // eslint-disable-next-line @typescript-eslint/unbound-method\n\n\nHome.getInitialProps = function _callee(context) {\n  var req, store, fs, _require, EpubParser, files, booksInfo, _iteratorNormalCompletion, _didIteratorError, _iteratorError, _iterator, _step, file, _file$split, _file$split2, fileName, epubPath, _ref, book, viewers;\n\n  return _regeneratorRuntime.async(function _callee$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          req = context.req, store = context.store;\n\n          if (!req) {\n            _context.next = 46;\n            break;\n          }\n\n          fs = require('fs');\n          _require = require('@ridi/epub-parser'), EpubParser = _require.EpubParser;\n          files = fs.readdirSync('public/');\n          booksInfo = []; // eslint-disable-next-line no-restricted-syntax\n\n          _iteratorNormalCompletion = true;\n          _didIteratorError = false;\n          _iteratorError = undefined;\n          _context.prev = 9;\n          _iterator = files[Symbol.iterator]();\n\n        case 11:\n          if (_iteratorNormalCompletion = (_step = _iterator.next()).done) {\n            _context.next = 31;\n            break;\n          }\n\n          file = _step.value;\n\n          if (!isEpubFile(file)) {\n            _context.next = 28;\n            break;\n          }\n\n          _file$split = file.split('.epub'), _file$split2 = _slicedToArray(_file$split, 1), fileName = _file$split2[0];\n          epubPath = \"epub/\".concat(fileName);\n          _context.prev = 16;\n          _context.next = 19;\n          return _regeneratorRuntime.awrap(getBookInfo(EpubParser, {\n            epubFile: fileName,\n            epubPath: epubPath\n          }));\n\n        case 19:\n          _ref = _context.sent;\n          book = _ref.book;\n          viewers = _ref.viewers;\n          booksInfo.push({\n            book: book,\n            viewers: viewers,\n            publicPath: epubPath\n          });\n          _context.next = 28;\n          break;\n\n        case 25:\n          _context.prev = 25;\n          _context.t0 = _context[\"catch\"](16);\n          console.log('Error index.', _context.t0);\n\n        case 28:\n          _iteratorNormalCompletion = true;\n          _context.next = 11;\n          break;\n\n        case 31:\n          _context.next = 37;\n          break;\n\n        case 33:\n          _context.prev = 33;\n          _context.t1 = _context[\"catch\"](9);\n          _didIteratorError = true;\n          _iteratorError = _context.t1;\n\n        case 37:\n          _context.prev = 37;\n          _context.prev = 38;\n\n          if (!_iteratorNormalCompletion && _iterator[\"return\"] != null) {\n            _iterator[\"return\"]();\n          }\n\n        case 40:\n          _context.prev = 40;\n\n          if (!_didIteratorError) {\n            _context.next = 43;\n            break;\n          }\n\n          throw _iteratorError;\n\n        case 43:\n          return _context.finish(40);\n\n        case 44:\n          return _context.finish(37);\n\n        case 45:\n          store.dispatch(booksActions.setBookList(booksInfo));\n\n        case 46:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, [[9, 33, 37, 45], [16, 25], [38,, 40, 44]], Promise);\n};\n\nexport default Home;","map":null,"metadata":{},"sourceType":"module"}